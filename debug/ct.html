<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<div id="console"></div>
</body>
<script>
  let output = document.getElementById("console");

  async function getCameras(facingMode) {

    let verifyConstraints = function(capabilities){
      let result = true;
      if(facingMode){
        if(capabilities.facingMode && Array.isArray(capabilities.facingMode) && capabilities.facingMode.length>0 && capabilities.facingMode.indexOf(facingMode) === -1){
          result = false;
        }
      }
      return result;
    }


    let cameras = [];
    let devices = await navigator.mediaDevices.enumerateDevices()
    for (let i = 0; i < devices.length; i++) {
      let device = devices[i];
      if (device.kind === 'videoinput') {

        try {
          let stream = await navigator.mediaDevices.getUserMedia({
            video: {
              deviceId: device.id
            }
          });
          let track = stream.getVideoTracks()[0];
          let cameraCapabilities = track.getCapabilities();
          track.stop();
          //console.log(device, cameraCapabilities);
          if(verifyConstraints(cameraCapabilities)){
            cameras.push({id:device.deviceId, label:device.label});
          }
        } catch (err) {
          alert(err);
        }
      }
    }
    return cameras;
  }

  function log(...args){
    output.appendChild(document.createElement("br"));
    output.appendChild(document.createElement("br"));
    for(let arg of args){
      if(typeof arg === "object"){
        arg = JSON.stringify(arg);
      }
      output.append(arg);
    }
  }

  async function test(){
    let environmentCameras = await getCameras("environment");
    log("environmentCameras ", environmentCameras);
    let userCameras = await getCameras("user");
    log("userCameras ", userCameras);
    let allCameras = await getCameras();
    log("all ", allCameras);
  }

  test();

</script>
</html>
